import os
import json
import requests
from flask import Flask, request

app = Flask(__name__)

# –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
BOT_TOKEN = os.environ.get('BOT_TOKEN')
WEB_APP_URL = "https://qwaszx112233.github.io/telegram-love-puzzle/"

def send_message(chat_id, text, keyboard=None):
    url = f'https://api.telegram.org/bot{BOT_TOKEN}/sendMessage'
    data = {'chat_id': chat_id, 'text': text, 'parse_mode': 'HTML'}
    
    if keyboard:
        data['reply_markup'] = json.dumps(keyboard)
    
    try:
        response = requests.post(url, json=data)
        return response.status_code == 200
    except:
        return False

def create_main_keyboard():
    """–°–æ–∑–¥–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–æ–π –∏–≥—Ä—ã"""
    return {
        'inline_keyboard': [[
            {
                'text': 'üéÆ –ì—Ä–∞—Ç–∏ –≤ Love Puzzle',
                'web_app': {'url': WEB_APP_URL}
            }
        ]]
    }

@app.route('/')
def home():
    return "üíñ Love Puzzle Bot is running!"

@app.route('/webhook', methods=['POST'])
def webhook():
    update = request.get_json()
    
    if 'message' in update:
        message = update['message']
        chat_id = message['chat']['id']
        text = message.get('text', '')
        user_name = message['chat'].get('first_name', '–∫–æ—Ö–∞–Ω–∞')
        
        if text == '/start':
            keyboard = create_main_keyboard()
            
            welcome_text = f"""
üíñ <b>Love Number Puzzle</b> üíñ

–ü—Ä–∏–≤—ñ—Ç {user_name}! –õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ –≥—Ä–∏ –ª—é–±–æ–≤—ñ —Ç–∞ —á–∏—Å–µ–ª! ‚ù§Ô∏è

üéÆ <b>–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:</b>
‚Ä¢ 30 —Ä–æ–º–∞–Ω—Ç–∏—á–Ω–∏—Ö —Ä—ñ–≤–Ω—ñ–≤
‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
‚Ä¢ –õ—é–±–æ–≤–Ω—ñ —Ñ—Ä–∞–∑–∏
‚Ä¢ –ö—Ä–∞—Å–∏–≤—ñ –∞–Ω—ñ–º–∞—Ü—ñ—ó

–ù–∞—Ç–∏—Å–Ω–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂—á–µ, —â–æ–± —Ä–æ–∑–ø–æ—á–∞—Ç–∏ –≥—Ä—É! üíï
            """
            send_message(chat_id, welcome_text, keyboard)
            
        elif text == '/game':
            keyboard = create_main_keyboard()
            send_message(chat_id, "üéÆ –ó–∞–ø—É—Å–∫–∞–π –≥—Ä—É —Ç–∞ –Ω–∞—Å–æ–ª–æ–¥–∂—É–π—Å—è –∫–æ—Ö–∞–Ω–Ω—è–º! üíï", keyboard)

        elif text == '/help':
            keyboard = create_main_keyboard()
            help_text = """
<b>üìñ –î–æ–≤—ñ–¥–∫–∞ –ø–æ –≥—Ä—ñ Love Number Puzzle</b>

üéØ <b>–ú–µ—Ç–∞ –≥—Ä–∏:</b>
–û–±'—î–¥–Ω—É–π —á–∏—Å–ª–∞, —â–æ–± –≤—ñ–¥–∫—Ä–∏–≤–∞—Ç–∏ —Ä–æ–º–∞–Ω—Ç–∏—á–Ω—ñ —Ñ—Ä–∞–∑–∏ —Ç–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç–∏ —Ä—ñ–≤–Ω—ñ!

<b>üî¢ –ü—Ä–∞–≤–∏–ª–∞ –≥—Ä–∏:</b>
‚Ä¢ –û–±'—î–¥–Ω—É–π –æ–¥–Ω–∞–∫–æ–≤—ñ —á–∏—Å–ª–∞
‚Ä¢ –û–±'—î–¥–Ω—É–π —á–∏—Å–ª–∞, —â–æ –≤—ñ–¥—Ä—ñ–∑–Ω—è—é—Ç—å—Å—è –≤ 2 —Ä–∞–∑–∏
‚Ä¢ –ö–æ–∂–Ω–µ –ø–æ—î–¥–Ω–∞–Ω–Ω—è –≤—ñ–¥–∫—Ä–∏–≤–∞—î –ª—é–±–æ–≤–Ω—É —Ñ—Ä–∞–∑—É
‚Ä¢ –ü—Ä–æ–π–¥–∏ –≤—Å—ñ 30 —Ä—ñ–≤–Ω—ñ–≤

<b>üéÆ –ö–æ–º–∞–Ω–¥–∏ –±–æ—Ç–∞:</b>
/start - –ü–æ—á–∞—Ç–∏ —Ä–æ–±–æ—Ç—É
/game - –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –≥—Ä—É  
/help - –î–æ–≤—ñ–¥–∫–∞
/about - –ü—Ä–æ –≥—Ä—É
/support - –ü—ñ–¥—Ç—Ä–∏–º–∫–∞

<b>üíæ –°–∏—Å—Ç–µ–º–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è:</b>
‚Ä¢ –ü—Ä–æ–≥—Ä–µ—Å –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
‚Ä¢ –ú–æ–∂–Ω–∞ –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ –∑ –±—É–¥—å-—è–∫–æ–≥–æ —Ä—ñ–≤–Ω—è
‚Ä¢ –î–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —É –≤–∞—à–æ–º—É –±—Ä–∞—É–∑–µ—Ä—ñ

–ì–æ—Ç–æ–≤–∏–π –¥–æ —Ä–æ–º–∞–Ω—Ç–∏—á–Ω–æ—ó –ø—Ä–∏–≥–æ–¥–∏? ü•∞
            """
            send_message(chat_id, help_text, keyboard)

        elif text == '/about':
            keyboard = create_main_keyboard()
            about_text = """
<b>üíñ –ü—Ä–æ –≥—Ä—É Love Number Puzzle</b>

‚ú® <b>–°—Ç–≤–æ—Ä–µ–Ω–æ –∑ –ª—é–±–æ–≤'—é</b>

–¶—è –≥—Ä–∞ –±—É–ª–∞ —Å—Ç–≤–æ—Ä–µ–Ω–∞ —è–∫ –æ—Å–æ–±–ª–∏–≤–∏–π –ø–æ–¥–∞—Ä—É–Ω–æ–∫ –∫–æ—Ö–∞–Ω—ñ–π –ª—é–¥–∏–Ω—ñ. –ö–æ–∂–Ω–∞ –ª—é–±–æ–≤–Ω–∞ —Ñ—Ä–∞–∑–∞, –∫–æ–∂–Ω–∞ –∞–Ω—ñ–º–∞—Ü—ñ—è —Å–µ—Ä—Ü—è - —Ü–µ —â–µ –æ–¥–Ω–µ –≤–∏–∑–Ω–∞–Ω–Ω—è –≤ –∫–æ—Ö–∞–Ω–Ω—ñ.

<b>üåü –û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:</b>
‚Ä¢ 30 —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö —Ä—ñ–≤–Ω—ñ–≤ —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ
‚Ä¢ 40+ —Ä–æ–º–∞–Ω—Ç–∏—á–Ω–∏—Ö —Ñ—Ä–∞–∑ —Ç–∞ –ø–æ—Å–ª–∞–Ω—å
‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–µ—Å—É
‚Ä¢ –ö—Ä–∞—Å–∏–≤—ñ –≤—ñ–∑—É–∞–ª—å–Ω—ñ –µ—Ñ–µ–∫—Ç–∏
‚Ä¢ –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤

<b>‚ù§Ô∏è –Ü–¥–µ—è –≥—Ä–∏:</b>
–ü–æ—î–¥–Ω—É–≤–∞—Ç–∏ —á–∏—Å–ª–∞ —Ç–∞ –≤—ñ–¥–∫—Ä–∏–≤–∞—Ç–∏ –ª—é–±–æ–≤ - —â–æ –º–æ–∂–µ –±—É—Ç–∏ –∫—Ä–∞—â–µ? –¶–µ –Ω–µ –ø—Ä–æ—Å—Ç–æ –≥–æ–ª–æ–≤–æ–ª–æ–º–∫–∞, —Ü–µ —Å–ø–æ—Å—ñ–± —Å–∫–∞–∑–∞—Ç–∏ "—è –∫–æ—Ö–∞—é —Ç–µ–±–µ" –æ—Å–æ–±–ª–∏–≤–∏–º —á–∏–Ω–æ–º.

<code>–í–µ—Ä—Å—ñ—è: 2.0 | –°—Ç–≤–æ—Ä–µ–Ω–æ –∑ ‚ù§Ô∏è</code>
            """
            send_message(chat_id, about_text, keyboard)

        elif text == '/support':
            support_text = """
<b>üÜò –î–æ–ø–æ–º–æ–≥–∞ —Ç–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞</b>

–Ø–∫—â–æ —É –≤–∞—Å –≤–∏–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º–∏ –∑ –≥—Ä–æ—é –∞–±–æ —î –ø–∏—Ç–∞–Ω–Ω—è:

<b>üîß –ü–æ—à–∏—Ä–µ–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏ —Ç–∞ —Ä—ñ—à–µ–Ω–Ω—è:</b>

‚Ä¢ <b>–ì—Ä–∞ –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è</b>
  - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç-–∑'—î–¥–Ω–∞–Ω–Ω—è
  - –û–Ω–æ–≤—ñ—Ç—å —Å—Ç–æ—Ä—ñ–Ω–∫—É
  - –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ –æ—Å—Ç–∞–Ω–Ω—é –≤–µ—Ä—Å—ñ—é Telegram

‚Ä¢ <b>–ü—Ä–æ–≥—Ä–µ—Å –Ω–µ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è</b>
  - –î–æ–∑–≤–æ–ª—å—Ç–µ cookies —É –≤–∞—à–æ–º—É –±—Ä–∞—É–∑–µ—Ä—ñ
  - –ù–µ –æ—á–∏—â—É–π—Ç–µ –¥–∞–Ω—ñ —Å–∞–π—Ç—É

‚Ä¢ <b>–ü–æ–º–∏–ª–∫–∏ —É –≥—Ä—ñ</b>
  - –°–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –≥—Ä—É
  - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å Telegram

<b>üìß –ó–≤'—è–∑–æ–∫ –∑ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–æ–º:</b>
–Ø–∫—â–æ –ø—Ä–æ–±–ª–µ–º–∏ –ø—Ä–æ–¥–æ–≤–∂—É—é—Ç—å—Å—è, –∑–≤'—è–∂—ñ—Ç—å—Å—è –∑ –Ω–∞–º–∏:
@bergmann1

<b>üí° –ü–æ—Ä–∞–¥–∞:</b>
–ì—Ä–∞ –Ω–∞–π–∫—Ä–∞—â–µ –ø—Ä–∞—Ü—é—î –≤ –æ—Å—Ç–∞–Ω–Ω—ñ—Ö –≤–µ—Ä—Å—ñ—è—Ö Telegram —Ç–∞ —Å—É—á–∞—Å–Ω–∏—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö.

–î—è–∫—É—î–º–æ, —â–æ –≥—Ä–∞—î—Ç–µ –≤ Love Number Puzzle! üíï
            """
            send_message(chat_id, support_text)

        else:
            # –û—Ç–≤–µ—Ç –Ω–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
            keyboard = create_main_keyboard()
            unknown_text = f"""
–ü—Ä–∏–≤—ñ—Ç {user_name}! üëã

–Ø –±–æ—Ç –¥–ª—è —Ä–æ–º–∞–Ω—Ç–∏—á–Ω–æ—ó –≥—Ä–∏ <b>Love Number Puzzle</b>! üíñ

–ù–µ —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤ –≤–∞—à—É –∫–æ–º–∞–Ω–¥—É. –û—Å—å —â–æ —è –≤–º—ñ—é:

<b>üéÆ –û—Å–Ω–æ–≤–Ω—ñ –∫–æ–º–∞–Ω–¥–∏:</b>
/start - –ü–æ—á–∞—Ç–∏ —Ä–æ–±–æ—Ç—É –∑ –±–æ—Ç–æ–º
/game - –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –≥—Ä—É
/help - –î–µ—Ç–∞–ª—å–Ω–∞ –¥–æ–≤—ñ–¥–∫–∞ –ø–æ –≥—Ä—ñ
/about - –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –≥—Ä—É
/support - –î–æ–ø–æ–º–æ–≥–∞ —Ç–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞

<b>üíù –©–æ —Ç–∞–∫–µ Love Number Puzzle?</b>
–¶–µ —É–Ω—ñ–∫–∞–ª—å–Ω–∞ –≥—Ä–∞-–≥–æ–ª–æ–≤–æ–ª–æ–º–∫–∞, –¥–µ —Ç–∏ –æ–±'—î–¥–Ω—É—î—à —á–∏—Å–ª–∞ —Ç–∞ –≤—ñ–¥–∫—Ä–∏–≤–∞—î—à —Ä–æ–º–∞–Ω—Ç–∏—á–Ω—ñ —Ñ—Ä–∞–∑–∏. –Ü–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –ø–∞—Ä–∏! 

–ù–∞—Ç–∏—Å–Ω–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂—á–µ, —â–æ–± —Ä–æ–∑–ø–æ—á–∞—Ç–∏ —Ä–æ–º–∞–Ω—Ç–∏—á–Ω—É –ø—Ä–∏–≥–æ–¥—É! ü•∞
            """
            send_message(chat_id, unknown_text, keyboard)
    
    return 'OK'

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)
